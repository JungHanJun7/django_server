
<!-- <!DOCTYPE html>
<html>
  <head>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // 웹소켓 연결을 설정합니다.
        var socket = new WebSocket("ws://127.0.0.1:8000/ws/snmp/");

        socket.onopen = function (event) {
          console.log("Connected to the WebSocket server.");

          // 5초마다 웹소켓으로 메시지를 보내는 함수를 실행합니다.
          setInterval(function () {
            sendMessage();
          }, 5000);
        };

        socket.onmessage = function (event) {
          console.log("Received message from server:", event.data);
        };

        socket.onclose = function (event) {
          console.log("Disconnected from the WebSocket server.");
        };

        // 메시지를 보내는 함수를 정의합니다.
        function sendMessage() {
          var message = "1.3.6.1.2.1.6.6.0";
          console.log("Sending message to server:", message);
          socket.send(message);
        }
      });
    </script>
  </head>
  <body>
    <h1>WebSocket Test</h1>
  </body>
</html> -->

<!DOCTYPE html>
<html>
  <head>
    <style>
      body {
        margin: 0;
      }

      ul {
        list-style-type: none;
        margin: 0;
        padding: 0;
        width: 120px;
        background-color: #f1f1f1;
        position: fixed;
        height: 100%;
        overflow: auto;
      }

      li a {
        display: block;
        color: #000;
        padding: 8px 16px;
        text-decoration: none;
      }

      li a.active {
        background-color: #555;
        color: white;
      }

      li a:hover:not(.active) {
        background-color: #555;
        color: white;
      }
      .container {
			display: flex;
			flex-wrap: wrap;
			width: 100%;
			/* height: 100%; */
			margin: 0 0 20px 0;
			padding: 0;
			box-sizing: border-box;
		}
		
		.box {
			flex-basis: 25%;
			height: 25vh;
			box-sizing: border-box;
			border: 1px solid black;
		}
    .box-1 {
			flex-grow: 1;
		}
		
		.box-2 {
			flex-grow: 2;
		}
    </style>
  </head>
  <body>
    <ul>
      <li><a class="active" href="../html/snmp.html">SNMP</a></li>
      <li><a href="../html/snort.html">SNORT</a></li>
      <li><a href="../html/alert.html">ALERT</a></li>
    </ul>

    <div style="margin-left: 10%; padding: 1px 16px; height: 250px">
      <h1>SNMP</h1>
      <div class="container">
        <div class="box box-1">
          <canvas id="myChart"></canvas>
          <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
          <script>
            document.addEventListener("DOMContentLoaded", function (){
              // 웹소켓 연결을 설정합니다.
              var socket = new WebSocket("ws://127.0.0.1:8000/ws/snmp/");

              socket.onopen = function (event) {
                console.log("Connected to the WebSocket server.");

                // 5초마다 웹소켓으로 메시지를 보내는 함수를 실행합니다.
                setInterval(function () {
                  sendMessage_TCP();
                }, 2000);
              };
            
              socket.onmessage = function (event) {
                console.log("Received message from server:", event.data);

                updateChartData(event.data);
              };
            
              socket.onclose = function (event) {
                console.log("Disconnected from the WebSocket server.");
              };
            
              // 메시지를 보내는 함수를 정의합니다.
              function sendMessage_TCP() {
                var message = "1.3.6.1.2.1.6.10.0,1.3.6.1.2.1.6.11.0";
                console.log("Sending message to server:", message);
                socket.send(message);
              }

              function updateChartData(newData) {
                d = newData.split(',')
                if (myChart.data.labels.length >= 7) {
                    myChart.data.datasets[0].data.unshift(); // Remove the first data point
                    myChart.data.datasets[1].data.unshift(); // Remove the first data point
                }
                myChart.data.datasets[0].data.unshift(d[0]);
                myChart.data.datasets[1].data.unshift(d[1]);
                console.log(newData);
                
                myChart.update(); // Update the chart with the new data
              }


              const ctx = document.getElementById('myChart');
              const myChart = new Chart(ctx, {
                type: 'line',
                data: {
                  labels: ['Index 1','Index 2','Index 3','Index 4','Index 5','Index 6','Index 7'],
                  datasets: [
                    {
                      label: "tcpInSegs",
                      data: [0, 0, 0, 0, 0, 0, 0],
                      borderColor: "rgb(255, 99, 132)",
                      backgroundColor: "rgba(255, 99, 132, 0.2)",
                      borderWidth: 1
                    },
                    {
                      label: "tcpOutSegs",
                      data: [0, 0, 0, 0, 0, 0, 0],
                      borderColor: "rgb(54, 162, 235)",
                      backgroundColor: "rgba(54, 162, 235, 0.2)",
                      borderWidth: 1
                    }
                  ]
                },
                options: {
                  scales: {
                    yAxes: [{
                      ticks: {
                        min: 800000,
                        max: 1000000
                      }
                    }]
                  }
                }
              });
            });
          </script>
        </div>
        <div class="box box-1">
          <canvas id="myChart2"></canvas>
          <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
          <script>
            document.addEventListener("DOMContentLoaded", function (){
              // 웹소켓 연결을 설정합니다.
              var socket = new WebSocket("ws://127.0.0.1:8000/ws/snmp/");

              socket.onopen = function (event) {
                console.log("Connected to the WebSocket server.");

                // 5초마다 웹소켓으로 메시지를 보내는 함수를 실행합니다.
                setInterval(function () {
                  sendMessage_UDP();
                }, 2000);
              };
            
              socket.onmessage = function (event) {
                console.log("Received message from server:", event.data);

                updateChartUDPData(event.data);
              };
            
              socket.onclose = function (event) {
                console.log("Disconnected from the WebSocket server.");
              };
            function sendMessage_UDP() {
                var message = "1.3.6.1.2.1.7.1.0,1.3.6.1.2.1.7.4.0";
                console.log("Sending message to server:", message);
                socket.send(message);
              }

              function updateChartUDPData(newData) {
                d = newData.split(',')
                if (myChart2.data.labels.length >= 7) {
                    myChart2.data.datasets[0].data.unshift(); // Remove the first data point
                    myChart2.data.datasets[1].data.unshift(); // Remove the first data point
                }
                myChart2.data.datasets[0].data.unshift(d[0]);
                myChart2.data.datasets[1].data.unshift(d[1]);      
                console.log(newData);
                
                myChart2.update(); // Update the chart with the new data
              }
              const ctx2 = document.getElementById('myChart2');
              const myChart2 = new Chart(ctx2, {
                type: 'line',
                data: {
                  labels: ['Index 1','Index 2','Index 3','Index 4','Index 5','Index 6','Index 7'],
                  datasets: [
                    {
                      label: "udpInSegs",
                      data: [0, 0, 0, 0, 0, 0, 0],
                      borderColor: "rgb(255, 99, 132)",
                      backgroundColor: "rgba(255, 99, 132, 0.2)",
                      borderWidth: 1
                    },
                    {
                      label: "udpOutSegs",
                      data: [0, 0, 0, 0, 0, 0, 0],
                      borderColor: "rgb(54, 162, 235)",
                      backgroundColor: "rgba(54, 162, 235, 0.2)",
                      borderWidth: 1
                    }
                  ]
                },
                options: {
                  scales: {
                    yAxes: [{
                      ticks: {
                        min: 600000,
                        max: 800000
                      }
                    }]
                  }
                }
              });
            });
          </script>
        </div>
        <div class="box box-1">
          <canvas id="myChart3"></canvas>
          <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
          <script>
            document.addEventListener("DOMContentLoaded", function (){
              // 웹소켓 연결을 설정합니다.
              var socket = new WebSocket("ws://127.0.0.1:8000/ws/snmp/");

              socket.onopen = function (event) {
                console.log("Connected to the WebSocket server.");

                // 5초마다 웹소켓으로 메시지를 보내는 함수를 실행합니다.
                setInterval(function () {
                  sendMessage_ICMP();
                }, 2000);
              };
            
              socket.onmessage = function (event) {
                console.log("Received message from server:", event.data);

                updateChartICMPData(event.data);
              };
            
              socket.onclose = function (event) {
                console.log("Disconnected from the WebSocket server.");
              };
            function sendMessage_ICMP() {
                var message = "1.3.6.1.2.1.5.1.0,1.3.6.1.2.1.5.14.0";
                console.log("Sending message to server:", message);
                socket.send(message);
              }

              function updateChartICMPData(newData) {
                d = newData.split(',')
                if (myChart3.data.labels.length >= 7) {
                    myChart3.data.datasets[0].data.unshift(); // Remove the first data point
                    myChart3.data.datasets[1].data.unshift(); // Remove the first data point
                }
                myChart3.data.datasets[0].data.unshift(d[0]);
                myChart3.data.datasets[1].data.unshift(d[1]);      
                console.log(newData);
                
                myChart3.update(); // Update the chart with the new data
              }
              const ctx3 = document.getElementById('myChart3');
              const myChart3 = new Chart(ctx3, {
                type: 'line',
                data: {
                  labels: ['Index 1','Index 2','Index 3','Index 4','Index 5','Index 6','Index 7'],
                  datasets: [
                    {
                      label: "icmpInSegs",
                      data: [0, 0, 0, 0, 0, 0, 0],
                      borderColor: "rgb(255, 99, 132)",
                      backgroundColor: "rgba(255, 99, 132, 0.2)",
                      borderWidth: 1
                    },
                    {
                      label: "icmpOutSegs",
                      data: [0, 0, 0, 0, 0, 0, 0],
                      borderColor: "rgb(54, 162, 235)",
                      backgroundColor: "rgba(54, 162, 235, 0.2)",
                      borderWidth: 1
                    }
                  ]
                },
                options: {
                  scales: {
                    yAxes: [{
                      ticks: {
                        min: 200,
                        max: 800
                      }
                    }]
                  }
                }
              });
            });
          </script>
        </div>
      </div>
      <div class="container">
        <div class="box box-2">
          <script src="https://code.highcharts.com/highcharts.js"></script>
          <script src="https://code.highcharts.com/highcharts-more.js"></script>
            <style>
              .highcharts-figure,
              .highcharts-data-table table {
                  min-width: 200px;
                  max-width: 300px;
                  margin: 1em auto;
              }
              </style>
            <div class = 'highcharts-figure' id="myChart4">
              <script>
                  Highcharts.chart('myChart4', {
                  chart: {
                      type: 'gauge',
                      plotBackgroundColor: null,
                      plotBackgroundImage: null,
                      plotBorderWidth: 0,
                      plotShadow: false,
                      height: '70%'
                  },
      
                  title: {
                      text: 'Speedometer'
                  },
      
                  pane: {
                      startAngle: -90,
                      endAngle: 89.9,
                      background: null,
                      center: ['50%', '75%'],
                      size: '110%'
                  },
      
                  // the value axis
                  yAxis: {
                      min: 0,
                      max: 200,
                      tickPixelInterval: 72,
                      tickPosition: 'inside',
                      tickColor: Highcharts.defaultOptions.chart.backgroundColor || '#FFFFFF',
                      tickLength: 20,
                      tickWidth: 2,
                      minorTickInterval: null,
                      labels: {
                          distance: 20,
                          style: {
                              fontSize: '14px'
                          }
                      },
                      plotBands: [{
                          from: 0,
                          to: 120,
                          color: '#55BF3B', // green
                          thickness: 20
                      }, {
                          from: 120,
                          to: 160,
                          color: '#DDDF0D', // yellow
                          thickness: 20
                      }, {
                          from: 160,
                          to: 200,
                          color: '#DF5353', // red
                          thickness: 20
                      }]
                  },
      
                  series: [{
                      name: 'Speed',
                      data: [80],
                      tooltip: {
                          valueSuffix: ' Mbps'
                      },
                      dataLabels: {
                          format: '{y} Mbps',
                          borderWidth: 0,
                          color: (
                              Highcharts.defaultOptions.title &&
                              Highcharts.defaultOptions.title.style &&
                              Highcharts.defaultOptions.title.style.color
                          ) || '#333333',
                          style: {
                              fontSize: '16px'
                          }
                      },
                      dial: {
                          radius: '80%',
                          backgroundColor: 'gray',
                          baseWidth: 12,
                          baseLength: '0%',
                          rearLength: '0%'
                      },
                      pivot: {
                          backgroundColor: 'gray',
                          radius: 6
                      }
      
                  }]
      
                  });
                  // Add some life
                  // setInterval(() => {
                  // const chart = Highcharts.charts[0];
                  // if (chart && !chart.renderer.forExport) {
                  //     const point = chart.series[0].points[0],
                  //         inc = Math.round((Math.random() - 0.5) * 20);
      
                  //     let newVal = point.y + inc;
                  //     if (newVal < 0 || newVal > 200) {
                  //         newVal = point.y - inc;
                  //     }
      
                  //     point.update(newVal);
                  // }
      
                  // }, 3000);
                  document.addEventListener("DOMContentLoaded", function (){
                  // 웹소켓 연결을 설정합니다.
                  var socket = new WebSocket("ws://127.0.0.1:8000/ws/snmp/");

                  socket.onopen = function (event) {
                    console.log("Connected to the WebSocket server.");

                    // 5초마다 웹소켓으로 메시지를 보내는 함수를 실행합니다.
                    setInterval(function () {
                      sendMessage_Speed();
                    }, 2000);
                  };
                
                  socket.onmessage = function (event) {
                    console.log("Received message from server:", event.data);

                    updateChartSpeedData(event.data);
                  };
                
                  socket.onclose = function (event) {
                    console.log("Disconnected from the WebSocket server.");
                  };
                  function sendMessage_Speed() {
                    var message = "1.3.6.1.2.1.2.2.1.16.11,1.3.6.1.2.1.2.2.1.10.11";
                    console.log("Sending message to server:", message);
                    socket.send(message);
                  }

                  let prevInOctets = 0;
                  let prevOutOctets = 0;
                  let prevTime = 0;

                  function updateChartSpeedData(newData) {
                    // // 쉼표를 기준으로 문자열을 분리하여 배열에 저장합니다.
                    // var dataArr = newData.split(",");

                    // // 첫 번째 데이터는 ifInOctets 값입니다.
                    // var ifInOctets = parseInt(dataArr[0]);

                    // // 두 번째 데이터는 ifOutOctets 값입니다.
                    // var ifOutOctets = parseInt(dataArr[1]);

                    // // ifInOctets와 ifOutOctets 값을 이용해 속도를 계산합니다.
                    // var speed = (ifInOctets + ifOutOctets) * 8 / 2000;

                    // // 속도 값을 차트에 반영합니다.
                    // Highcharts.charts[0].series[0].points[0].update(Math.round(speed));
                    const data = newData.split(",");
                    const inOctets = parseInt(data[0]);
                    const outOctets = parseInt(data[1]);
                    const time = Date.now();

                    const timeDiff = (time - prevTime) / 1000; // in seconds
                    const inSpeed = (inOctets - prevInOctets) / timeDiff;
                    const outSpeed = (outOctets - prevOutOctets) / timeDiff;

                    var speed = (inSpeed + outSpeed) * 8 / 2000 / 1000;
                    
                    if (speed != 0){
                      Highcharts.charts[0].series[0].points[0].update(Math.round(speed));
                      
                      // Update the previous data
                      prevInOctets = inOctets;
                      prevOutOctets = outOctets;
                      prevTime = time;
                      prevspeed = speed;
                    }
                  }
                });
              </script>
          </div>
        </div>
        <div class="box box-2">
          <canvas id="myChart5"></canvas>
          <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
          <script>
            const ctx5 = document.getElementById('myChart5');
            const myChart5 = new Chart(ctx5, {
              type: 'doughnut',
              data: {
                labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
                datasets: [{
                  label: 'My First Dataset',
                  data: [12, 19, 3, 5, 2, 3],
                  backgroundColor: [
                    'rgb(255, 99, 132)',
                    'rgb(54, 162, 235)',
                    'rgb(255, 205, 86)',
                    'rgb(75, 192, 192)',
                    'rgb(153, 102, 255)',
                    'rgb(255, 159, 64)'
                  ],
                  hoverOffset: 4
                }]
              },
              options: {
                responsive: true,
                plugins: {
                  legend: {
                    position: 'top',
                  },
                  title: {
                    display: true,
                    text: 'Chart.js Doughnut Chart'
                  }
                }
              }
            });
          </script>
        </div>
      </div>
      <div class="container">
        <div class="box box-1">Box 6</div>
        <div class="box box-1">Box 7</div>
        <div class="box box-1">Box 8</div>
      </div>
    </div>
  </body>
</html>
